

# 基础
- 目标，依赖，命令 
- 显示规则，隐含规则，变量定义，指示符，注释
- make 通过比较对应文件（目标与依赖）的最后修改时间，来决定哪些文件需要更新，对于需要哥哥内心的文件，make会执行会执行数据库中所记录的相应命令（make在读取makefile以后会建立一个编译过程的描述数据库，此数据库中记录了所有各个文件之间的相互关系，以及它们的关系描述）来重建它。
（略）


## 变量
- 变量的定义可以不顶行写，但是不可以tab键开始。 
- 可以理解makefile中的变量为C语言中的宏，其大小写敏感，传统上变量名全部采用大写，推荐对于参数列表采用大写，内部定义的一般变量采用小写
- 延时变量
    - =, ？=, define指令, 定义的变量均为延时变量
    - 缺点：
        - 递归展开，可能导致make陷入到无限循环展开中而执行失败。
        - 每一次变量被展开时，包含在变量中的函数都要执行一次，导致执行效率低下，或可能导致变量和函数的引用出现非预期的结果（无法与之其何时被展开）
- 立即变量
    - := 定义的为立即变量
    - 由于其在定义时就进行了展开，因此不能实现对其后定义的变量的引用，类似C语言函数调用的接口必须在此之前有声明或定义，
    - 在复杂的makefile中，推荐使用直接展开式变量，使其具有一定程度的可预测性。
- 变量的引用：
    - $() 或 ${}
    - $x 仅用于引用单字符的情况
    - 当命令或者文件名中要使$符号时，$$ 表示

- 变量的替换应用将后缀字符使用制定的字符进行替换， patsubst 函数的简化版
        ```
        foo := a.o b.o c.o o.o
        bar := $(foo:.o=.c)
        ==> bar 值为 a.c b.c c.c o.c
        ```
- 变量名中若是存在函数或其他变量的引用，在定义时即会执行或者展开
- 当引用一个没有定义的变量时，默认值为空
- 追加变量 +=， 
    - 其结果不改变展开类型，原变量是直接展开类型则仍然是展开类型，原变量是递归展开类型（延时变量）则仍然是递归展开类型
    - 如下两种定义，若此时$(include)尚未定义，则将导致结果不同
        ```
        CFLAGS = $(includes) -O
        CFLAGS += -pg # enable profiling
        ```
        ```
        CFLAGS := $(CFLAGS) -pg # enable profiling
        ```

## 条件语句
- ifeq， ifneq
    - 格式：
    ```
    `ifeq (ARG1, ARG2)' 
    `ifeq 'ARG1' 'ARG2'' 
    `ifeq "ARG1" "ARG2"' 
    `ifeq "ARG1" 'ARG2'' 
    `ifeq 'ARG1' "ARG2"'
    ```
    - 当判断是否为空是，考虑到变量在展开过程中可能造成参数中包含空字符，因此采用strip函数：
    ```
    ifeq ($(strip $(foo)),)
    text_if_empty
    endif    
    ```
    - 在make读取makefile文件时计算表达式的值，因此条件判断中，不可使用**自动化变量**，自动化变量在规则命令执行时才有效。
- else
- endif

## 执行make
- 退出状态：
    - 0,执行成功
    - 1,执行出错，同时会提示错误信息
    - 2,
- 指定makefile
    - -f 制定makefile文件，不限文件名
    - 没有指定时在工作目录（当前目录）依次搜索GNUmakefile,makefile,Makefile,
    - 隐含规则：不存在上述三种makefile文件也没有指定文件时，执行：
        `make foo.o`, 若当前目录存在foo.c，将会执行：`cc -c -o foo.o foo.c`
- 伪目标
    - 其目的不在于去创建目标文件，而在于执行一些特定的命令，因此其目标不代表一个真正的文件名，一般也将伪目标称为标签，典型的即为:clean
    - .PHONY
        - 将一个目标声明为一个伪目标，这样make就不会根据隐含规则来创建它，提高了执行效率：
        ```
        .PHONY:clean
        clean:
            rm *.o temp
        ```
    - 